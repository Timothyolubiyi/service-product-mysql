{% extends "base.html" %}

{% block title %}List All Customers{% endblock %}

{% block content %}
<h2 class="text-center mt-4 mb-3">All Customers</h2>

<table border="1" cellpadding="10" cellspacing="0" width="80%" align="center">
    <thead style="background-color:#f0f0f0;">
        <tr>
            <th>CustomerId</th>
            <th>Customername</th>
            <th>Email</th>
            <th>ServiceId</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for row in rows %}
        <tr>
            <td>{{ row.CustomerId }}</td>
            <td>{{ row.Customername }}</td>
            <td>{{ row.Email }}</td>
            <td>{{ row.ServiceId }}</td>
            <td>
                <!-- Edit customers -->
                <form action="{{ url_for('edit_customer', id=row.CustomerId) }}" method="GET" style="display:inline;">
                    <button type="submit" class="edit-btn">Edit</button>
                </form>

                <!-- Delete customers-->
                <form class="delete-form" action="{{ url_for('delete_customer', id=row.CustomerId) }}" method="POST" style="display:inline;">
                    <button type="button" class="delete-btn">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Delete confirmation -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.delete-btn').forEach(button => {
    button.addEventListener('click', function(e) {
      const form = this.closest('.delete-form');
      Swal.fire({
        title: 'Are you sure?',
        text: "This customer will be permanently deleted.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'Cancel'
      }).then((result) => {
        if (result.isConfirmed) form.submit();
      });
    });
  });
});
</script>

<!-- Success/Error toast -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        {% for category, message in messages %}
        Swal.fire({
          toast: true,
          position: 'top-end',
          icon: '{{ category }}',
          title: '{{ message }}',
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true
        });
        {% endfor %}
      });
    </script>
  {% endif %}
{% endwith %}
{% endblock %}